<!DOCTYPE html>
<html lang="es">
<head>
  <link rel="manifest" href="manifest.json">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Partidos - <span id="dynamic-title">Liga de Softball Ñanguete</span></title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"/>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap');

  :root {
    --primary-color: #3f51b5; /* Deeper blue for primary actions/headers */
    --secondary-color: #ff9800; /* Vibrant orange for accents */
    --background-color: #f0f2f5; /* Light grey for softer background */
    --text-color: #333;
    --light-color: #fff;
    --border-color: #e0e0e0; /* Softer border color */
    --success-color: #4caf50;
    --error-color: #f44336;
    --info-color: #2196f3;
    --warning-color: #ffc107; /* Brighter warning color */
    --shadow-light: 0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.24);
    --shadow-medium: 0 3px 6px rgba(0, 0, 0, 0.16), 0 3px 6px rgba(0, 0, 0, 0.23);

    /* Variables for sticky column widths */
    --col1-width: 40px; /* Width for '#' column - reduced */
    --col2-width: 110px; /* Adjusted Width for 'Jugador' column - smaller */
    --col3-width: 70px; /* Width for 'Posición' column - smaller */
    --col-delete-width: 40px; /* Width for 'Eliminar' column (the 'x' button) */
  }

  body {
    font-family: 'Roboto', sans-serif;
    background: var(--background-color);
    margin: 0;
    padding: 20px;
    color: var(--text-color);
    line-height: 1.6;
    box-sizing: border-box; /* Ensures padding doesn't affect total width */
  }

  header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    background-color: var(--primary-color);
    padding: 15px 25px;
    border-radius: 12px;
    margin-bottom: 30px;
    box-shadow: var(--shadow-medium);
    color: var(--light-color);
    flex-wrap: wrap; /* Allows items to wrap on smaller screens */
  }

  header img {
    height: 65px; /* Slightly larger logo */
    filter: drop-shadow(0 3px 4px rgba(0, 0, 0, 0.3));
    margin-right: 15px; /* Space between logo and title */
  }

  header h1 {
    margin: 0;
    font-size: 28px; /* Larger title */
    color: var(--light-color);
    text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.3);
    flex-grow: 1;
    text-align: center;
    font-weight: 700;
  }

  .header-button {
    background-color: var(--light-color);
    color: var(--primary-color);
    border: none;
    padding: 10px 18px;
    border-radius: 8px;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: var(--shadow-light);
    display: flex;
    align-items: center;
    gap: 8px;
    margin-left: 15px; /* Space between title and button */
  }

  .header-button:hover {
    background-color: var(--secondary-color);
    color: var(--light-color);
    transform: translateY(-2px);
    box-shadow: var(--shadow-medium);
  }

  .section-container {
    background: var(--light-color);
    padding: 25px;
    border-radius: 12px;
    margin-bottom: 30px;
    box-shadow: var(--shadow-light);
    transition: transform 0.2s ease-in-out;
  }

  .section-container:hover {
    transform: translateY(-3px);
  }

  h2 {
    margin-top: 0; /* Remove default top margin */
    margin-bottom: 20px;
    color: var(--primary-color);
    border-bottom: 3px solid var(--secondary-color); /* Thicker, more pronounced border */
    padding-bottom: 10px;
    font-size: 24px;
    display: flex;
    align-items: center;
    gap: 10px;
    font-weight: 700;
  }
    /* Added for sticky lineup titles */
  .lineup-header-container {
    position: sticky;
    top: 0; /* Or adjust if you have a sticky header above this */
    z-index: 100; /* Ensure it stays on top */
    background: var(--light-color); /* Match section container background */
    padding-top: 15px; /* Add some padding if needed */
    padding-bottom: 10px;
    border-bottom: 1px solid var(--border-color); /* Optional: a subtle border */
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .lineup-header-container h2 {
    margin: 0; /* Remove default margins */
    border-bottom: none; /* Remove border as it's now on the container */
  }

  .form-group {
    display: flex;
    flex-wrap: wrap;
    gap: 15px 25px;
    align-items: center;
    margin-bottom: 25px;
    padding: 20px;
    border-radius: 8px;
    background-color: #fdfdfd;
    box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.05);
  }

  .form-group label {
    font-weight: bold;
    color: var(--primary-color);
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .form-group input,
  .form-group select {
    padding: 12px 15px;
    border-radius: 8px;
    border: 1px solid var(--border-color);
    width: 100%;
    font-size: 16px;
    transition: border-color 0.3s ease, box-shadow 0.3s ease;
    background-color: var(--light-color);
  }

  .form-group input:focus,
  .form-group select:focus {
    border-color: var(--primary-color);
    outline: none;
    box-shadow: 0 0 0 3px rgba(63, 81, 181, 0.2); /* Primary color shadow */
  }

  /* Added a wrapper for tables to handle overflow */
  .table-wrapper {
    width: 100%;
    overflow: visible !important; /* Desactiva cualquier tipo de scroll */
    margin-top: 20px;
    box-shadow: var(--shadow-light);
    border-radius: 12px;
  }

  table {
    width: 100%;
    border-collapse: separate; /* Use separate for border-radius on cells */
    border-spacing: 0;
    background-color: var(--light-color);
    min-width: fit-content; /* Ensure table doesn't shrink smaller than content */
  }

  th,
  td {
    padding: 14px 10px;
    border-bottom: 1px solid var(--border-color);
    text-align: center;
    white-space: nowrap; /* Prevent content from wrapping in cells */
    min-width: 60px; /* Ensure a minimum width for readability */
    box-sizing: border-box; /* Include padding and border in the element's total width and height */
  }

  th {
    background-color: var(--primary-color);
    color: var(--light-color);
    font-weight: bold;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    position: sticky; /* Make headers stick on scroll */
    top: 0;
    z-index: 10;
  }

  /* Specific styling for table header corners */
  .table-wrapper thead th:first-child {
    border-top-left-radius: 12px;
  }

  .table-wrapper thead th:last-child {
    border-top-right-radius: 12px;
  }

  tr:nth-child(even) {
    background-color: #f9f9f9;
  }

  tr:hover {
    background-color: #eef;
    transform: scale(1.005);
    transition: background-color 0.2s ease, transform 0.2s ease;
  }

  /* --- Sticky Columns for Lineup Tables --- */
  /* # column */
  .sticky-column-1 {
    position: sticky;
    left: 0;
    z-index: 5; /* Lower than header, higher than regular cells */
    background-color: var(--light-color); /* Ensure background is solid */
    min-width: var(--col1-width);
    width: var(--col1-width);
    max-width: var(--col1-width);
  }
  .table-wrapper thead .sticky-column-1 {
    z-index: 15; /* Higher than regular headers */
    background-color: var(--primary-color);
  }

  /* Jugador column */
  .sticky-column-2 {
    position: sticky;
    left: var(--col1-width);
    z-index: 4;
    background-color: var(--light-color);
    min-width: var(--col2-width);
    width: var(--col2-width);
    max-width: var(--col2-width);
  }
  .table-wrapper thead .sticky-column-2 {
    z-index: 14;
    background-color: var(--primary-color);
  }

  /* Posicion column */
  .sticky-column-3 {
    position: sticky;
    left: calc(var(--col1-width) + var(--col2-width));
    z-index: 3;
    background-color: var(--light-color);
    min-width: var(--col3-width);
    width: var(--col3-width);
    max-width: var(--col3-width);
  }
  .table-wrapper thead .sticky-column-3 {
    z-index: 13;
    background-color: var(--primary-color);
  }
  
  /* NEW: Delete Button column */
  .sticky-column-delete {
    position: sticky;
    left: calc(var(--col1-width) + var(--col2-width) + var(--col3-width)); /* Position after other sticky columns */
    z-index: 2; /* Lower than other sticky columns, higher than regular cells */
    background-color: var(--light-color);
    min-width: var(--col-delete-width);
    width: var(--col-delete-width);
    max-width: var(--col-delete-width);
  }
  .table-wrapper thead .sticky-column-delete {
    z-index: 12; /* Higher than regular headers */
    background-color: var(--primary-color);
  }

  /* Style for inning columns to hide them by default */
  .inning-column {
    display: none;
  }

  /* Style for the currently active inning column */
  .inning-column.active {
    display: table-cell;
  }

  /* Ensure rows with even background color also apply to sticky cells */
  tr:nth-child(even) .sticky-column-1,
  tr:nth-child(even) .sticky-column-2,
  tr:nth-child(even) .sticky-column-3,
  tr:nth-child(even) .sticky-column-delete {
      background-color: #f9f9f9;
  }

  tr:hover .sticky-column-1,
  tr:hover .sticky-column-2,
  tr:hover .sticky-column-3,
  tr:hover .sticky-column-delete {
      background-color: #eef;
  }

  /* --- NEW STYLING FOR JUGADOR SELECT --- */
  .jugador-select {
    padding: 6px 8px; /* Reduced padding */
    border: 1px solid var(--border-color);
    border-radius: 6px;
    width: 100%; /* Fill available space */
    font-size: 13px; /* Slightly smaller font */
    box-sizing: border-box; /* Crucial for width calculation */
    appearance: none; /* Remove default arrow in some browsers */
    background-color: var(--light-color);
    background-image: url('data:image/svg+xml;utf8,<svg fill="%23333" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/><path d="M0 0h24v24H0z" fill="none"/></svg>'); /* Custom arrow */
    background-repeat: no-repeat;
    background-position: right 8px center;
    background-size: 18px;
    cursor: pointer;
    text-overflow: ellipsis; /* Truncate text */
    overflow: hidden; /* Hide overflow text */
    white-space: nowrap; /* Prevent wrapping inside select */
    transition: border-color 0.3s ease, box-shadow 0.3s ease;
  }
  .jugador-select option:disabled { /* MODIFIED: Added style for disabled player options */
    color: #ccc;
    background-color: #f9f9f9;
  }

  .jugador-select:focus {
    border-color: var(--primary-color);
    outline: none;
    box-shadow: 0 0 0 3px rgba(63, 81, 181, 0.2);
  }

  /* For positional select, similar styling */
  .posicion-select {
    padding: 6px 8px;
    border: 1px solid var(--border-color);
    border-radius: 6px;
    width: 100%;
    font-size: 13px;
    box-sizing: border-box;
    appearance: none;
    background-color: var(--light-color);
    background-image: url('data:image/svg+xml;utf8,<svg fill="%23333" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/><path d="M0 0h24v24H0z" fill="none"/></svg>');
    background-repeat: no-repeat;
    background-position: right 8px center;
    background-size: 18px;
    cursor: pointer;
    transition: border-color 0.3s ease, box-shadow 0.3s ease;
  }
  .posicion-select option:disabled {
    color: #ccc;
    background-color: #f9f9f9;
  }

  .posicion-select:focus {
    border-color: var(--primary-color);
    outline: none;
    box-shadow: 0 0 0 3px rgba(63, 81, 181, 0.2);
  }

  /* NEW: Delete player button style */
  .delete-player-btn {
    background-color: var(--error-color);
    color: white;
    border: none;
    border-radius: 50%; /* Make it round */
    width: 25px; /* Fixed width and height for a small button */
    height: 25px;
    font-size: 14px;
    font-weight: bold;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background-color 0.2s ease, transform 0.2s ease;
    box-shadow: var(--shadow-light);
  }

  .delete-player-btn:hover {
    background-color: #d32f2f; /* Darker red on hover */
    transform: scale(1.1);
  }

  .agregar-btn {
    margin-top: 20px;
    background-color: var(--primary-color);
    color: white;
    padding: 12px 20px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: bold;
    transition: background-color 0.3s ease, transform 0.2s ease;
    box-shadow: var(--shadow-light);
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .agregar-btn:hover {
    background-color: #303f9f; /* Darker shade of primary */
    transform: translateY(-2px);
  }

  .ining-input {
    width: 50px; /* Slightly narrower to save space */
    padding: 6px; /* Reduced padding */
    border: 1px solid var(--border-color);
    border-radius: 6px;
    text-align: center;
    margin: 3px 0; /* Reduced margin */
    transition: border 0.3s ease, box-shadow 0.3s ease;
    font-size: 13px; /* Smaller font size */
  }

  .ining-input:focus {
    border-color: var(--secondary-color);
    outline: none;
    box-shadow: 0 0 0 2px rgba(255, 152, 0, 0.2);
  }

  .ining-select {
    padding: 6px; /* Reduced padding */
    border: 1px solid var(--border-color);
    border-radius: 6px;
    min-width: 80px; /* Reduced min-width */
    background-color: var(--light-color);
    transition: border 0.3s ease;
    font-size: 13px; /* Smaller font size */
    /* Added for consistency with other selects */
    appearance: none; 
    background-image: url('data:image/svg+xml;utf8,<svg fill="%23333" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/><path d="M0 0h24v24H0z" fill="none"/></svg>');
    background-repeat: no-repeat;
    background-position: right 6px center; /* Adjusted position */
    background-size: 16px; /* Smaller arrow */
    cursor: pointer;
  }

  .ining-select:focus {
    border-color: var(--secondary-color);
    outline: none;
  }

  .ining-label {
    display: block; /* Change to block for better stacking */
    margin-top: 5px; /* Reduced margin */
    padding: 4px 8px; /* Reduced padding */
    background-color: #f5f5f5; /* Lighter background for label */
    border-radius: 5px;
    font-size: 11px; /* Smaller font size */
    min-width: 60px; /* Reduced min-width */
    word-break: break-all;
    font-weight: 500;
    color: #555;
  }

  .ining-guardar {
    padding: 5px 10px; /* Reduced padding */
    margin-top: 5px; /* Reduced margin */
    background-color: var(--success-color);
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-size: 12px; /* Smaller font size */
    transition: background-color 0.3s ease, transform 0.2s ease;
    display: flex;
    align-items: center;
    gap: 4px; /* Reduced gap */
  }

  .ining-guardar:hover {
    background-color: #388e3c; /* Darker success shade */
    transform: translateY(-1px);
  }

  .popup {
    display: none;
    position: fixed; /* Use fixed for better pop-up behavior */
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: var(--light-color);
    border: 1px solid var(--border-color);
    padding: 25px;
    z-index: 1000;
    border-radius: 10px;
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.25); /* Stronger shadow for pop-up */
    max-width: 90%;
    width: 400px;
    box-sizing: border-box;
  }

  .ining-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    min-height: 120px; /* Reduced height */
    justify-content: space-around; /* Distribute space */
  }

  .team-name-input {
    border: none;
    border-bottom: 2px solid var(--primary-color);
    background: transparent;
    font-weight: bold;
    text-align: center;
    font-size: 18px; /* Slightly larger font */
    padding: 5px 8px;
    width: calc(100% - 16px); /* Adjust width for padding */
    color: var(--primary-color);
    transition: border-color 0.3s ease;
    max-width: 250px; /* Limit max width */
  }

  .team-name-input:focus {
    outline: none;
    border-bottom-color: var(--secondary-color);
  }

  .resumen-label {
    font-weight: bold;
    padding: 8px;
    min-width: 30px;
    display: inline-block;
    font-size: 18px; /* Larger score font */
    color: var(--text-color);
  }

  .total-cell {
    font-size: 22px; /* Even larger total score */
    color: var(--primary-color);
    font-weight: 700;
  }

  .action-buttons {
    display: flex;
    gap: 15px; /* Increased gap */
    margin-bottom: 25px;
    justify-content: center;
    flex-wrap: wrap;
  }

  .action-button {
    padding: 12px 20px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: bold;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 8px;
    box-shadow: var(--shadow-light);
  }

  .action-button:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-medium);
  }

  .export-btn {
    background-color: var(--info-color);
    color: white;
  }

  .export-btn:hover {
    background-color: #1976d2; /* Darker info shade */
  }

  .import-btn {
    background-color: #9c27b0;
    color: white;
  }

  .import-btn:hover {
    background-color: #7b1fa2;
  }

  .finish-btn {
    background-color: var(--error-color);
    color: white;
  }

  .finish-btn:hover {
    background-color: #d32f2f;
  }

  .reset-btn {
    background-color: var(--warning-color);
    color: #333; /* Darker text for warning background */
  }

  .reset-btn:hover {
    background-color: #fbc02d; /* Darker warning shade */
  }

  .registros-container {
    margin-top: 15px;
    max-height: 350px; /* Slightly taller */
    overflow-y: auto;
    border: 1px solid var(--border-color);
    border-radius: 8px;
    padding: 15px;
    background-color: white;
    box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.05);
  }

  .registro-item {
    padding: 10px;
    border-bottom: 1px solid #eee;
    font-family: 'Roboto Mono', monospace; /* More modern monospace font */
    font-size: 15px;
    color: #444;
  }

  .registro-item:last-child {
    border-bottom: none;
  }

  .inning-extra-btn {
    margin-top: 20px;
    background-color: var(--secondary-color);
    color: white;
    padding: 10px 18px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: bold;
    transition: background-color 0.3s ease, transform 0.2s ease;
    box-shadow: var(--shadow-light);
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .inning-extra-btn:hover {
    background-color: #fb8c00; /* Darker secondary shade */
    transform: translateY(-2px);
  }

  .inning-navigation {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 10px;
    margin-bottom: 15px;
    padding: 5px 0;
    background-color: var(--background-color); /* Light background for navigation */
    border-radius: 8px;
  }

  .inning-navigation button {
    background-color: var(--primary-color);
    color: white;
    border: none;
    padding: 8px 15px;
    border-radius: 5px;
    cursor: pointer;
    font-weight: bold;
    transition: background-color 0.2s ease;
  }

  .inning-navigation button:hover {
    background-color: #303f9f;
  }

  .inning-navigation button:disabled {
    background-color: #ccc;
    cursor: not-allowed;
  }

  .current-inning-display {
    font-size: 16px;
    font-weight: bold;
    color: var(--primary-color);
  }

  /* NEW STYLING FOR GAME DETAILS (made smaller) */
  .game-details-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); /* Adjusted min-width */
    gap: 10px; /* Reduced gap */
    margin-top: 20px; /* Reduced margin */
    padding: 15px; /* Reduced padding */
    border: 1px solid var(--border-color);
    border-radius: 8px;
    background-color: #fbfbfc;
    box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.03);
  }

  .game-detail-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 8px; /* Reduced padding */
    border: 1px solid #e9e9e9;
    border-radius: 8px;
    background-color: var(--light-color);
    box-shadow: var(--shadow-light);
    transition: transform 0.2s ease;
  }

  .game-detail-item:hover {
    transform: translateY(-2px);
  }

  .game-detail-item strong {
    font-size: 14px; /* Smaller font */
    color: var(--primary-color);
    margin-bottom: 4px; /* Reduced margin */
  }

  .game-detail-item span {
    font-size: 20px; /* Smaller font */
    font-weight: bold;
    color: var(--secondary-color);
  }

  .inning-status-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    font-weight: bold;
    font-size: 18px; /* Smaller font */
    color: var(--primary-color);
  }
  .inning-status-item .status-text {
    font-size: 24px; /* Smaller font */
    color: var(--secondary-color);
    margin-bottom: 4px; /* Reduced margin */
  }

  .inning-control-buttons {
    display: flex;
    gap: 8px; /* Reduced gap */
    margin-top: 8px; /* Reduced margin */
  }

  .inning-control-buttons button {
    padding: 6px 10px; /* Reduced padding */
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-weight: bold;
    transition: background-color 0.2s ease;
    box-shadow: var(--shadow-light);
    font-size: 12px; /* Smaller font */
  }

  .inning-control-buttons .toggle-inning-btn {
    background-color: var(--info-color);
    color: white;
  }

  .inning-control-buttons .toggle-inning-btn:hover {
    background-color: #1976d2;
  }

  .inning-control-buttons .reset-outs-btn {
    background-color: var(--warning-color);
    color: #333;
  }

  .inning-control-buttons .reset-outs-btn:hover {
    background-color: #fbc02d;
  }

  .bases-display {
    display: flex;
    gap: 4px; /* Reduced gap */
    margin-top: 8px; /* Reduced margin */
    font-size: 12px; /* Smaller font */
    font-weight: bold;
    color: #666;
  }
  .bases-display .base {
    width: 22px; /* Smaller size */
    height: 22px; /* Smaller size */
    border: 2px solid var(--primary-color);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: #eee;
    color: #999;
    font-size: 10px; /* Smaller text inside base */
  }
  .bases-display .base.occupied {
    background-color: var(--success-color);
    border-color: var(--success-color);
    color: white;
  }
  .base-control-buttons {
    display: flex;
    gap: 6px; /* Reduced gap */
    margin-top: 8px; /* Reduced margin */
    flex-wrap: wrap;
  }
  .base-control-buttons button {
    padding: 5px 9px; /* Reduced padding */
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 12px; /* Smaller font */
    transition: background-color 0.2s ease;
    background-color: #5cb85c; /* Greenish for add */
    color: white;
    box-shadow: var(--shadow-light);
  }
  .base-control-buttons button:hover {
    background-color: #4cae4c;
  }
  .base-control-buttons button.clear {
    background-color: #f0ad4e; /* Orange for clear */
  }
  .base-control-buttons button.clear:hover {
    background-color: #ec971f;
  }


  .toggle-details-btn {
    background-color: var(--primary-color);
    color: white;
    padding: 10px 18px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: bold;
    transition: background-color 0.3s ease, transform 0.2s ease;
    box-shadow: var(--shadow-light);
    display: flex;
    align-items: center;
    gap: 8px;
    margin-top: 20px;
  }
  .toggle-details-btn:hover {
    background-color: #303f9f;
    transform: translateY(-2px);
  }


  /* For hidden content */
  .hidden {
    display: none !important;
  }


  /* --- Responsive Design (Media Queries) --- */

  /* For Tablets and larger phones (e.g., 768px to 1024px) */
  @media (max-width: 1024px) {
    body {
      padding: 15px;
    }

    header {
      padding: 15px;
      flex-direction: column;
      text-align: center;
    }

    header img {
      margin-bottom: 10px;
      margin-right: 0;
    }

    header h1 {
      font-size: 26px;
      margin-bottom: 10px;
    }

    .header-button {
      margin-left: 0;
      margin-top: 10px;
    }

    .section-container {
      padding: 20px;
      margin-bottom: 25px;
    }

    h2 {
      font-size: 22px;
    }

    .form-group {
      grid-template-columns: 1fr; /* Stack inputs vertically */
      gap: 15px;
    }

    table {
      font-size: 13px;
    }

    th,
    td {
      padding: 10px 5px;
    }

    .team-name-input {
      font-size: 16px;
      max-width: 100%;
    }

    .resumen-label {
      font-size: 16px;
    }

    .total-cell {
      font-size: 20px;
    }

    .ining-input,
    .ining-select,
    .ining-guardar {
      font-size: 13px;
      padding: 6px;
    }

    .ining-label {
      font-size: 11px;
      padding: 5px;
    }

    .action-buttons {
      flex-direction: column; /* Stack action buttons */
      gap: 10px;
    }

    .action-button {
      width: 100%; /* Full width for stacked buttons */
      justify-content: center;
    }
    
    .delete-player-btn {
        width: 22px;
        height: 22px;
        font-size: 12px;
    }

    /* Game details container adjustment */
    .game-details-container {
      grid-template-columns: repeat(auto-fit, minmax(130px, 1fr)); /* Adjusted min-width */
      gap: 8px; /* Reduced gap */
    }
    .game-detail-item strong {
        font-size: 13px; /* Even smaller */
    }
    .game-detail-item span {
        font-size: 18px; /* Even smaller */
    }
    .inning-status-item {
        font-size: 16px; /* Even smaller */
    }
    .inning-status-item .status-text {
        font-size: 22px; /* Even smaller */
    }
    .inning-control-buttons button,
    .base-control-buttons button {
        padding: 5px 8px; /* Even smaller */
        font-size: 11px; /* Even smaller */
    }
    .bases-display .base {
        width: 20px; /* Even smaller */
        height: 20px; /* Even smaller */
        font-size: 9px; /* Even smaller */
    }
  }

  /* For Mobile devices (e.g., up to 767px) */
  @media (max-width: 767px) {
    body {
      padding: 10px;
    }

    header {
      padding: 10px;
    }

    header img {
      height: 50px;
    }

    header h1 {
      font-size: 22px;
    }

    .header-button {
      padding: 8px 12px;
      font-size: 14px;
    }

    .section-container {
      padding: 15px;
      margin-bottom: 20px;
    }

    h2 {
      font-size: 20px;
    }

    .form-group input,
    .form-group select {
      font-size: 14px;
      padding: 10px;
    }

    /* Adjust sticky column widths for smaller screens */
    :root {
      --col1-width: 35px; /* Even smaller for # */
      --col2-width: 90px; /* Smaller Jugador */
      --col3-width: 60px; /* Smaller Posición */
      --col-delete-width: 35px; /* Smaller delete button */
    }

    /* Further adjust padding and font sizes for selects in lineup */
    .jugador-select,
    .posicion-select {
        padding: 4px 6px; /* Even less padding */
        font-size: 12px; /* Smaller font */
        background-size: 14px; /* Smaller arrow */
    }

    /* Adjust inning specific styles */
    .ining-input {
      width: 40px; /* Even narrower */
      padding: 4px; /* Even less padding */
      font-size: 12px; /* Smaller font */
    }
    .ining-select {
      min-width: 60px;
      padding: 4px; /* Even less padding */
      font-size: 12px; /* Smaller font */
      background-size: 14px; /* Smaller arrow */
    }
    .ining-label {
      font-size: 10px; /* Smallest font */
      padding: 3px 6px; /* Minimal padding */
      min-width: 50px; /* Smallest min-width */
    }
    .ining-guardar {
      padding: 4px 8px; /* Smaller button */
      font-size: 11px; /* Smaller font */
      gap: 3px;
    }
    .ining-container {
      min-height: 100px;
    }

    th, td {
      min-width: unset; /* Remove min-width to allow shrinking */
      max-width: unset; /* Remove max-width */
      padding: 8px 3px; /* Reduced padding for all cells */
    }

    .team-name-input {
      font-size: 14px;
      padding: 3px 5px;
    }

    .resumen-label {
      font-size: 14px;
    }

    .total-cell {
      font-size: 18px;
    }

    .agregar-btn,
    .inning-extra-btn {
      padding: 10px 15px;
      font-size: 14px;
    }

    .registros-container {
      max-height: 250px;
      padding: 10px;
    }

    .registro-item {
      font-size: 13px;
      padding: 6px;
    }

    /* Game details container adjustment for small screens */
    .game-details-container {
      grid-template-columns: 1fr; /* Stack details vertically */
      gap: 8px;
    }
    .game-detail-item strong {
        font-size: 12px; /* Smallest */
    }
    .game-detail-item span {
        font-size: 16px; /* Smallest */
    }
    .inning-status-item {
        font-size: 14px; /* Smallest */
    }
    .inning-status-item .status-text {
        font-size: 20px; /* Smallest */
    }
    .inning-control-buttons, .base-control-buttons {
      justify-content: center;
    }
  }

  /* Specific adjustments for Landscape Orientation on Mobile */
  @media (max-width: 820px) and (orientation: landscape) {
    body {
      padding: 15px;
    }

    header {
      flex-direction: row; /* Keep header elements in a row */
      justify-content: space-between;
      align-items: center;
      padding: 10px 20px;
    }
    header h1 {
      font-size: 24px;
    }
    header img {
      height: 60px;
      margin-bottom: 0;
    }
    .header-button {
      margin-top: 0;
    }

    /* Adjust column widths slightly for landscape if needed */
    :root {
      --col1-width: 40px;
      --col2-width: 100px; /* Slightly wider than portrait */
      --col3-width: 65px;  /* Slightly wider than portrait */
      --col-delete-width: 40px;
    }

    .jugador-select,
    .posicion-select {
        padding: 5px 7px;
        font-size: 12.5px;
    }

    .ining-input {
      width: 45px;
      padding: 5px;
      font-size: 12.5px;
    }
    .ining-select {
      min-width: 70px;
      padding: 5px;
      font-size: 12.5px;
    }
    .ining-label {
      font-size: 10.5px;
      padding: 4px 7px;
      min-width: 55px;
    }
    .ining-guardar {
      font-size: 11.5px;
      padding: 5px 10px;
    }
    .ining-container {
      min-height: 110px;
    }
  }

</style>
</head>
<body>
  <header>
    <img src="BEISBOL ESTADISTICAS-LOGO.png" alt="Logo Liga Ñanguete" />
    <h1>PARTIDOS - <span id="dynamic-title">LIGA ÑANGUETE</span></h1>
    <a href="index.html"><button class="header-button"><i class="fas fa-home"></i> Inicio</button></a>
  </header>

  <div class="section-container">
    <div class="form-group">
      <label for="fecha"><i class="far fa-calendar-alt"></i> Fecha:</label>
      <input type="date" id="fecha" />
  
      <label for="formato"><i class="fas fa-list-ol"></i> Formato:</label>
      <select id="formato" onchange="cambiarFormato()"></select> <!-- Agregado onchange -->
  
      <label for="numeroJuego"><i class="fas fa-hashtag"></i> Número de juego:</label>
      <input type="number" id="numeroJuego" min="1" />
    </div>
  </div>

  <div class="section-container" id="resumen-container">
    <h2><i class="fas fa-clipboard-list"></i> Resumen del Juego</h2>
    <div class="table-wrapper">
      <table>
        <thead>
          <tr>
            <th>Equipo</th>
            <th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th><th>7</th><th>8</th><th>9</th>
            <th>Total</th>
          </tr>
        </thead>
        <tbody>
          <tr> <td><input type="text" class="team-name-input" id="visitante-team-name" placeholder="Nombre visitante" onchange="actualizarNombreEquipoResumen('visitante')" /></td>
            <td><div class="resumen-label" id="visitante-1">0</div></td>
            <td><div class="resumen-label" id="visitante-2">0</div></td>
            <td><div class="resumen-label" id="visitante-3">0</div></td>
            <td><div class="resumen-label" id="visitante-4">0</div></td>
            <td><div class="resumen-label" id="visitante-5">0</div></td>
            <td><div class="resumen-label" id="visitante-6">0</div></td>
            <td><div class="resumen-label" id="visitante-7">0</div></td>
            <td><div class="resumen-label" id="visitante-8">0</div></td>
            <td><div class="resumen-label" id="visitante-9">0</div></td>
            <td class="total-cell"><strong id="visitante-total">0</strong></td>
          </tr>
          <tr> <td><input type="text" class="team-name-input" id="local-team-name" placeholder="Nombre local" onchange="actualizarNombreEquipoResumen('local')" /></td>
            <td><div class="resumen-label" id="local-1">0</div></td>
            <td><div class="resumen-label" id="local-2">0</div></td>
            <td><div class="resumen-label" id="local-3">0</div></td>
            <td><div class="resumen-label" id="local-4">0</div></td>
            <td><div class="resumen-label" id="local-5">0</div></td>
            <td><div class="resumen-label" id="local-6">0</div></td>
            <td><div class="resumen-label" id="local-7">0</div></td>
            <td><div class="resumen-label" id="local-8">0</div></td>
            <td><div class="resumen-label" id="local-9">0</div></td>
            <td class="total-cell"><strong id="local-total">0</strong></td>
          </tr>
        </tbody>
      </table>
    </div>
    <button class="inning-extra-btn" onclick="agregarInning()"><i class="fas fa-plus"></i> Agregar Inning Extra</button>

    <button class="toggle-details-btn" onclick="toggleGameDetails()"><i class="fas fa-cog"></i> Mostrar Detalles Adicionales</button>

    <div class="game-details-container hidden" id="game-details-container">
        <div class="game-detail-item inning-status-item">
            <strong>Inning Actual</strong>
            <span class="status-text" id="current-inning-status">Top 1</span>
            <div class="inning-control-buttons">
                <button class="toggle-inning-btn" onclick="toggleTopDown()"><i class="fas fa-arrows-alt-v"></i> Cambiar Parte</button>
            </div>
        </div>

        <div class="game-detail-item">
            <strong>Outs</strong>
            <span id="outs-display">0</span>
            <div class="inning-control-buttons">
                <button onclick="addOut()"><i class="fas fa-plus"></i> Out</button>
                <button class="reset-outs-btn" onclick="resetOuts()"><i class="fas fa-undo"></i> Reset</button>
            </div>
        </div>
        
        <div class="game-detail-item">
            <strong>Bases Ocupadas</strong>
            <div class="bases-display">
                <div class="base" id="base1">1B</div>
                <div class="base" id="base2">2B</div>
                <div class="base" id="base3">3B</div>
            </div>
            <div class="base-control-buttons">
                <button onclick="toggleBase(1)">1B</button>
                <button onclick="toggleBase(2)">2B</button>
                <button onclick="toggleBase(3)">3B</button>
                <button class="clear" onclick="clearBases()">Limpiar</button>
            </div>
        </div>

        <div class="game-detail-item">
            <strong>Hits (H)</strong>
            <span>Visitante: <span id="visitante-hits">0</span></span>
            <span>Local: <span id="local-hits">0</span></span>
        </div>

        <div class="game-detail-item">
            <strong>Errores (E)</strong>
            <span>Visitante: <span id="visitante-errors">0</span></span>
            <span>Local: <span id="local-errors">0</span></span>
        </div>
        
        <div class="game-detail-item">
            <strong>Jonrones (HR)</strong>
            <span>Visitante: <span id="visitante-hr">0</span></span>
            <span>Local: <span id="local-hr">0</span></span>
        </div>

        <div class="game-detail-item">
            <strong>Ponches (K)</strong>
            <span>Visitante: <span id="visitante-k">0</span></span>
            <span>Local: <span id="local-k">0</span></span>
        </div>
    </div>
  </div>

  <div class="section-container" id="lineups-grouped-section">
    <div class="lineup-header-container">
      <h2><i class="fas fa-users"></i> Lineup - <input type="text" class="team-name-input" id="lineup-visitante-name" placeholder="Nombre visitante" onchange="actualizarNombreEquipoLineup('visitante')" /></h2>
      <div class="inning-navigation" style="display: none;">
        </div>
    </div>
    <div class="table-wrapper">
      <table id="lineup-visitante">
        <thead>
          <tr>
            <th class="sticky-column-1">#</th>
            <th class="sticky-column-2">Jugador</th>
            <th class="sticky-column-3">Posición</th>
            <th class="sticky-column-delete"></th>
            </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
    <button class="agregar-btn" onclick="agregarJugador('lineup-visitante')"><i class="fas fa-plus"></i> Agregar Jugador</button>

    <div class="lineup-header-container" style="margin-top: 30px;"> <h2><i class="fas fa-users"></i> Lineup - <input type="text" class="team-name-input" id="lineup-local-name" placeholder="Nombre local" onchange="actualizarNombreEquipoLineup('local')" /></h2>
      <div class="inning-navigation">
        <button onclick="showPrevInning()"><i class="fas fa-chevron-left"></i></button>
        <span class="current-inning-display" id="current-inning-display">Inning 1</span> <button onclick="showNextInning()"><i class="fas fa-chevron-right"></i></button>
      </div>
    </div>
    <div class="table-wrapper">
      <table id="lineup-local">
        <thead>
          <tr>
            <th class="sticky-column-1">#</th>
            <th class="sticky-column-2">Jugador</th>
            <th class="sticky-column-3">Posición</th>
            <th class="sticky-column-delete"></th>
            </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
    <button class="agregar-btn" onclick="agregarJugador('lineup-local')"><i class="fas fa-plus"></i> Agregar Jugador</button>
  </div>
  <div class="section-container">
    <h2><i class="fas fa-history"></i> Registros del Juego</h2>
    
    <div class="action-buttons">
      <button class="action-button export-btn" onclick="exportarJuegoCSV()">
        <i class="fas fa-file-export"></i> Exportar Juego CSV
      </button>
      <button class="action-button import-btn" onclick="document.getElementById('file-input').click()">
        <i class="fas fa-file-import"></i> Importar Juego CSV
        <input type="file" id="file-input" accept=".csv" style="display: none;" onchange="importarJuegoCSV(event)">
      </button>
      <button class="action-button reset-btn" onclick="reiniciarPartido()">
        <i class="fas fa-redo"></i> Reiniciar Partido
      </button>
      <button class="action-button finish-btn" onclick="terminarPartido()">
        <i class="fas fa-flag-checkered"></i> Terminar Partido
      </button>
    </div>
    
    <!-- Botones adicionales para Guardar Juego e Historial de Juegos -->
    <div class="action-buttons">
        <button class="action-button export-btn" onclick="guardarJuego()">
    <i class="fas fa-save"></i> Guardar Juego
      </button>
      <button class="action-button import-btn" onclick="mostrarHistorialJuegos()">
        <i class="fas fa-history"></i> Historial de Juegos
      </button>
    </div>


    <div class="registros-container" id="registros-container">
      </div>
  </div>

  <div id="popup" class="popup"></div>

  <script>
    const posiciones = ["P", "C", "1B", "2B", "3B", "SS", "LF", "CF", "RF", "DH"];
    let registrosJuego = [];
    let maxInnings = 9;
    let currentInning = 1; 
    let isTopInning = true; 
    let outs = 0; 
    let bases = [false, false, false]; 

    let partidoData = {
      fecha: "",
      formato: "",
      numeroJuego: "",
      localTeamName: "Local",
      visitanteTeamName: "Visitante",
      localLineup: [], // Added to explicitly store lineup data
      visitanteLineup: [], // Added to explicitly store lineup data
      registros: [],
      maxInnings: 9,
      currentInning: 1, 
      isTopInning: true,
      outs: 0, 
      bases: [false, false, false],
      showDetails: false 
    };

    function obtenerJugadas() {
      const jugadasData = localStorage.getItem("jugadasData");
      if (jugadasData) {
        const jugadas = JSON.parse(jugadasData);
        return jugadas.map(jugada => ({
          nombre: jugada.jugada || jugada.nombre,
          descripcion: jugada.descripcion
        }));
      }
      return [];
    }

    function obtenerJugadores() {
        const jugadoresData = localStorage.getItem("jugadoresData");
        return jugadoresData ? JSON.parse(jugadoresData) : [];
    }

    function inicializarDatosEjemplo() {
      if (!localStorage.getItem("jugadasData")) {
        const jugadasEjemplo = [
          { jugada: "H", nombre: "H", descripcion: "Hit (generico)" }, { jugada: "H1", nombre: "H1", descripcion: "Sencillo" },
          { jugada: "H2", nombre: "H2", descripcion: "Doble" }, { jugada: "H3", nombre: "H3", descripcion: "Triple" },
          { jugada: "HR", nombre: "HR", descripcion: "Home Run" }, { jugada: "A", nombre: "A", descripcion: "Carrera Anotada" },
          { jugada: "CI", nombre: "CI", descripcion: "Carrera Impulsada" }, { jugada: "P", nombre: "P", descripcion: "Ponche" },
          { jugada: "BB", nombre: "BB", descripcion: "Base por Bolas" }, { jugada: "E-D", nombre: "E-D", descripcion: "Error de Defensor" },
          { jugada: "O", nombre: "O", descripcion: "Out (generico)" }, { jugada: "AR", nombre: "AR", descripcion: "Out por Regla" },
          { jugada: "FS", nombre: "FS", descripcion: "Foul Strike Out" }
        ];
        localStorage.setItem("jugadasData", JSON.stringify(jugadasEjemplo));
      }
      if (!localStorage.getItem("jugadoresData")) {
        localStorage.setItem("jugadoresData", JSON.stringify([
          { nombre: "Juan Pérez", equipo: "Local" }, { nombre: "Pedro González", equipo: "Local" },
          { nombre: "María Fernández", equipo: "Local", posicion: "P" }, { nombre: "Luis Rodríguez", equipo: "Visitante" },
          { nombre: "Ana García", equipo: "Visitante", posicion: "P" }, { nombre: "Carlos Sánchez", equipo: "Local" },
          { nombre: "Marta Díaz", equipo: "Visitante" }
        ]));
      }
      if (!localStorage.getItem("formatosData")) {
        localStorage.setItem("formatosData", JSON.stringify([
          { formato: "7 Entradas", descripcion: "7 entradas" }, { formato: "9 Entradas", descripcion: "9 entradas" }
        ]));
      }
    }

    function cargarFormatos() {
      const select = document.getElementById("formato");
      const formatosData = localStorage.getItem("formatosData");
      select.innerHTML = '<option value="">Seleccionar formato</option>'; // Clear existing options
      
      if (formatosData) {
        const formatos = JSON.parse(formatosData);
        formatos.forEach(f => {
          const option = document.createElement("option");
          option.value = f.descripcion; // Usamos la descripción como valor
          option.textContent = `${f.descripcion} (${f.cantidadInning} innings)`;
          option.dataset.innings = f.cantidadInning; // Almacenamos la cantidad de innings
          select.appendChild(option);
        });
      }
    }

    function cambiarFormato() {
      const select = document.getElementById("formato");
      const selectedOption = select.options[select.selectedIndex];
      const innings = selectedOption ? parseInt(selectedOption.dataset.innings) : 9;
      
      // Actualizar maxInnings y partidoData
      maxInnings = innings;
      partidoData.maxInnings = maxInnings;
      
      // Reconstruir la tabla resumen con los nuevos innings
      reconstruirTablaResumen();
      
      // Reconstruir los lineups con los nuevos innings
      reconstruirLineupInnings("lineup-local");
      reconstruirLineupInnings("lineup-visitante");
      
      // Mostrar el inning actual (o el 1 si es mayor que el nuevo máximo)
      showInning(currentInning <= maxInnings ? currentInning : 1);
      
      guardarEstadoPartido();
    }

    function updatePositionAvailability(tablaId) {
        const tabla = document.getElementById(tablaId);
        if (!tabla) return;
        const positionSelects = tabla.querySelectorAll("tbody .posicion-select");
        const allSelectedNonDHPositionsInTable = new Set();
        positionSelects.forEach(sel => {
            if (sel.value && sel.value !== "DH" && sel.value !== "") {
                allSelectedNonDHPositionsInTable.add(sel.value);
            }
        });
        positionSelects.forEach(currentSelect => {
            const currentValueInThisSelect = currentSelect.value;
            Array.from(currentSelect.options).forEach(option => {
                if (option.value === "" || option.value === "DH") {
                    option.disabled = false;
                } else {
                    option.disabled = allSelectedNonDHPositionsInTable.has(option.value) && option.value !== currentValueInThisSelect;
                }
            });
        });
    }

    function initializePositionSelectListeners(tablaId) {
        const tabla = document.getElementById(tablaId);
        if (!tabla) return;
        const positionSelects = tabla.querySelectorAll("tbody .posicion-select");
        const changeHandler = function() { updatePositionAvailability(tablaId); };
        positionSelects.forEach(select => {
            if (select._myPositionChangeHandler) {
                select.removeEventListener('change', select._myPositionChangeHandler);
            }
            select.addEventListener('change', changeHandler);
            select._myPositionChangeHandler = changeHandler; 
        });
        updatePositionAvailability(tablaId); 
    }

    function updatePlayerNameAvailability() {
        const allPlayerSelects = document.querySelectorAll("#lineup-local tbody .jugador-select, #lineup-visitante tbody .jugador-select");
        const globallySelectedPlayerNames = new Set();
        allPlayerSelects.forEach(select => {
            if (select.value && select.value !== "") { 
                globallySelectedPlayerNames.add(select.value);
            }
        });
        allPlayerSelects.forEach(currentSelect => {
            const currentValueInThisSelect = currentSelect.value;
            Array.from(currentSelect.options).forEach(option => {
                if (option.value === "") { 
                    option.disabled = false;
                } else {
                    option.disabled = globallySelectedPlayerNames.has(option.value) && option.value !== currentValueInThisSelect;
                }
            });
        });
    }

    function initializePlayerNameSelectListeners() {
        const allPlayerSelects = document.querySelectorAll("#lineup-local tbody .jugador-select, #lineup-visitante tbody .jugador-select");
        const changeHandler = function() { updatePlayerNameAvailability(); };
        allPlayerSelects.forEach(select => {
            if (select._myPlayerNameChangeHandler) {
                select.removeEventListener('change', select._myPlayerNameChangeHandler);
            }
            select.addEventListener('change', changeHandler);
            select._myPlayerNameChangeHandler = changeHandler;
        });
        updatePlayerNameAvailability(); 
    }

    function agregarJugador(tablaId) {
      const tabla = document.getElementById(tablaId);
      const tbody = tabla.querySelector("tbody");
      const jugadoresData = obtenerJugadores();
      const jugadasData = obtenerJugadas();
      if (jugadasData.length === 0) {
        alert("No hay jugadas registradas. Por favor, agregue jugadas primero.");
        return;
      }
      const tr = document.createElement("tr");
      const index = tbody.rows.length + 1; 
      const opcionesJugadores = jugadoresData.map(j => `<option value="${j.nombre}">${j.nombre}</option>`).join("");
      const opcionesPosiciones = posiciones.map(p => `<option value="${p}">${p}</option>`).join("");
      const opcionesJugadas = jugadasData.map(j => `<option value="${j.nombre}">${j.nombre}</option>`).join("");
      let celdasIning = "";
      for (let i = 0; i < maxInnings; i++) {
        const inningNumber = i + 1;
        const isActiveInning = (inningNumber === currentInning);
        celdasIning += `
          <td class="inning-column inning-${inningNumber} ${isActiveInning ? 'active' : ''}">
            <div class="ining-container">
              <select class="ining-select"><option value="">--</option>${opcionesJugadas}</select>
              <input type="number" class="ining-input" value="1" min="-999" max="999">
              <button class="ining-guardar" onclick="guardarJugada(this, '${tablaId}', ${inningNumber})"><i class="fas fa-save"></i> Guardar</button>
              <div class="ining-label"></div>
              <input type="hidden" class="pitcher-name-input" value="">
            </div>
          </td>`;
      }
      tr.innerHTML = `
        <td class="sticky-column-1">${index}</td>
        <td class="sticky-column-2"><select class="jugador-select"><option value="">Seleccionar</option>${opcionesJugadores}</select></td>
        <td class="sticky-column-3"><select class="posicion-select"><option value="">--</option>${opcionesPosiciones}</select></td>
        <td class="sticky-column-delete"><button class="delete-player-btn" onclick="eliminarJugador(this, '${tablaId}')">X</button></td>
        ${celdasIning}`;
      tbody.appendChild(tr);
      initializePositionSelectListeners(tablaId); 
      initializePlayerNameSelectListeners();
      guardarEstadoPartido(); 
    }

    function eliminarJugador(btn, tablaId) {
        if (!confirm("¿Estás seguro de que quieres eliminar a este jugador del lineup? Se perderán todas sus jugadas registradas en este partido.")) {
            return;
        }
        const rowToDelete = btn.closest("tr");
        const tbody = rowToDelete.parentElement;
        const jugadorSelect = rowToDelete.querySelector(".jugador-select"); 
        const nombreJugadorEliminado = jugadorSelect ? jugadorSelect.value : "";
        tbody.removeChild(rowToDelete);
        Array.from(tbody.children).forEach((row, idx) => {
            row.cells[0].textContent = idx + 1; 
        });
        const equipoDelLineup = tablaId.includes('local') ? 
            (document.getElementById('lineup-local-name').value || 'Local') : 
            (document.getElementById('lineup-visitante-name').value || 'Visitante');
        registrosJuego = registrosJuego.filter(registro => 
            !((registro.equipo === equipoDelLineup && registro.jugador === nombreJugadorEliminado) ||
              (registro.pitcherResponsable === nombreJugadorEliminado))
        );
        actualizarRegistrosUI();
        actualizarResumenGlobal(); 
        initializePositionSelectListeners(tablaId); 
        initializePlayerNameSelectListeners();
        guardarEstadoPartido(); 
    }

    function obtenerPitcherDelEquipo(equipoTablaId) {
        const otroEquipoTablaId = (equipoTablaId === 'lineup-local') ? 'lineup-visitante' : 'lineup-local';
        const tablaOtroEquipo = document.getElementById(otroEquipoTablaId);
        if (!tablaOtroEquipo) return "Desconocido";
        const filasOtroEquipo = tablaOtroEquipo.querySelectorAll("tbody tr");
        let pitcherNombre = "Desconocido";
        for (const row of filasOtroEquipo) {
            const posicionSelect = row.querySelector(".posicion-select");
            const jugadorSelect = row.querySelector(".jugador-select");
            if (posicionSelect && jugadorSelect && posicionSelect.value === "P" && jugadorSelect.value) {
                pitcherNombre = jugadorSelect.value;
                break; 
            }
        }
        return pitcherNombre;
    }

    function guardarJugada(btn, tablaId, inning) {
      const container = btn.parentElement;
      const select = container.querySelector(".ining-select");
      const input = container.querySelector(".ining-input");
      const label = container.querySelector(".ining-label");
      const pitcherInput = container.querySelector(".pitcher-name-input");
      const jugada = select.value;
      const cantidad = parseInt(input.value);
      if (jugada && !isNaN(cantidad)) {
        const pitcherResponsable = obtenerPitcherDelEquipo(tablaId);
        pitcherInput.value = pitcherResponsable;
        label.textContent += (label.textContent ? "+" : "") + `${cantidad}${jugada}`;
        const row = btn.closest("tr");
        const jugadorSelect = row.querySelector(".jugador-select");
        const posicionSelect = row.querySelector(".posicion-select");
        const jugador = jugadorSelect ? jugadorSelect.value : "Desconocido";
        const posicion = posicionSelect ? posicionSelect.value : "Desconocido";
        const equipo = tablaId.includes("local") ? 
          (document.getElementById("lineup-local-name").value || "Local") : 
          (document.getElementById("lineup-visitante-name").value || "Visitante");
        registrosJuego.push({
          fecha: document.getElementById("fecha").value,
          formato: document.getElementById("formato").value,
          numeroJuego: document.getElementById("numeroJuego").value,
          equipo: equipo, jugador: jugador, posicion: posicion, inning: inning,
          jugada: jugada, cantidad: cantidad, pitcherResponsable: pitcherResponsable, 
          timestamp: new Date().toISOString()
        });
        if (['O', 'AR', 'FS', 'P'].includes(jugada)) addOut(cantidad);
        select.value = "";
        input.value = "1";
        actualizarRegistrosUI();
        actualizarResumenGlobal(); 
        guardarEstadoPartido();
      } else {
        alert("Por favor, seleccione una jugada y asegúrese de que la cantidad sea un número válido.");
      }
    }

    function actualizarResumenGlobal() {
      actualizarResumenIndividual("visitante");
      actualizarResumenIndividual("local");
      actualizarEstadisticasAdicionales();
    }

    function actualizarResumenIndividual(equipo) {
      const tablaId = `lineup-${equipo}`;
      const tabla = document.getElementById(tablaId);
      if (!tabla) return; 
      const tbody = tabla.querySelector("tbody");
      if (!tbody) return;
      const sumasInnings = {};
      for (let i = 1; i <= maxInnings; i++) sumasInnings[i] = 0;
      tbody.querySelectorAll("tr").forEach(row => {
        for (let i = 4; i < 4 + maxInnings; i++) { 
          const cell = row.cells[i];
          if (cell) {
            const label = cell.querySelector(".ining-label");
            if (label && label.textContent) {
              const regex = /([+-]?\d+)A/g; 
              let match;
              while ((match = regex.exec(label.textContent)) !== null) {
                sumasInnings[i - 3] += parseInt(match[1]);
              }
            }
          }
        }
      });
      for (let inning = 1; inning <= maxInnings; inning++) {
        const labelEl = document.getElementById(`${equipo}-${inning}`);
        if (labelEl) labelEl.textContent = sumasInnings[inning] || "0";
      }
      const total = Object.values(sumasInnings).reduce((sum, val) => sum + val, 0);
      const totalEl = document.getElementById(`${equipo}-total`);
      if (totalEl) totalEl.textContent = total;
    }

    function actualizarEstadisticasAdicionales() {
        const visitanteTeamName = partidoData.visitanteTeamName || "Visitante"; // Usa desde partidoData
        const localTeamName = partidoData.localTeamName || "Local";         // Usa desde partidoData
        let localHits = 0, visitanteHits = 0, localErrors = 0, visitanteErrors = 0;
        let localHR = 0, visitanteHR = 0, localK = 0, visitanteK = 0;
        registrosJuego.forEach(registro => {
            const cantidad = parseInt(registro.cantidad);
            if (isNaN(cantidad)) return;
            const isLocalTeam = registro.equipo === localTeamName;
            const isVisitanteTeam = registro.equipo === visitanteTeamName;
            if (['H1', 'H2', 'H3', 'HR'].includes(registro.jugada)) {
                if (isLocalTeam) localHits += cantidad; else if (isVisitanteTeam) visitanteHits += cantidad;
            }
            if (registro.jugada === "HR") if (isLocalTeam) localHR += cantidad; else if (isVisitanteTeam) visitanteHR += cantidad;
            if (registro.jugada === "P") if (isLocalTeam) localK += cantidad; else if (isVisitanteTeam) visitanteK += cantidad;
            if (registro.jugada === "E-D") {
    		if (registro.equipo === localTeamName) {
        	    localErrors += cantidad;
    		} else if (registro.equipo === visitanteTeamName) {
        	    visitanteErrors += cantidad;
    		}
	    }
        });

        ['local', 'visitante'].forEach(type => {
            document.getElementById(`${type}-hits`).textContent = type === 'local' ? localHits : visitanteHits;
            document.getElementById(`${type}-errors`).textContent = type === 'local' ? localErrors : visitanteErrors;
            document.getElementById(`${type}-hr`).textContent = type === 'local' ? localHR : visitanteHR;
            document.getElementById(`${type}-k`).textContent = type === 'local' ? localK : visitanteK;
        });
        const inningStatusElement = document.getElementById('current-inning-status');
        if (inningStatusElement) inningStatusElement.textContent = `${isTopInning ? 'Top' : 'Down'} ${currentInning}`;
        document.getElementById('outs-display').textContent = outs;
        updateBasesDisplay();
    }
    
    function actualizarNombreEquipoLineup(tipo) {
      const input = document.getElementById(`lineup-${tipo}-name`);
      const resumenInput = document.getElementById(`${tipo}-team-name`);
      if (input && resumenInput) resumenInput.value = input.value;
      if (tipo === "visitante") partidoData.visitanteTeamName = input.value;
      else if (tipo === "local") partidoData.localTeamName = input.value;
      guardarEstadoPartido();
    }

    function actualizarNombreEquipoResumen(tipo) {
      const input = document.getElementById(`${tipo}-team-name`);
      const lineupInput = document.getElementById(`lineup-${tipo}-name`);
      if (input && lineupInput) lineupInput.value = input.value;
      if (tipo === "visitante") partidoData.visitanteTeamName = input.value;
      else if (tipo === "local") partidoData.localTeamName = input.value;
      guardarEstadoPartido();
    }

    function actualizarRegistrosUI() {
      const container = document.getElementById("registros-container");
      container.innerHTML = "";
      [...registrosJuego].sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp)).forEach(r => {
        const div = document.createElement("div");
        div.className = "registro-item";
        div.textContent = `[${new Date(r.timestamp).toLocaleTimeString()}] ${r.equipo} - ${r.jugador} (${r.posicion}): Inning ${r.inning} - ${r.cantidad}${r.jugada} (vs P: ${r.pitcherResponsable || 'N/A'})`;
        container.appendChild(div);
      });
    }

function exportarJuegoCSV() {
  if (registrosJuego.length === 0) {
    alert("No hay registros para exportar");
    return;
  }

  const headers = ["fecha", "formato", "numeroJuego", "equipo", "jugador", "posicion", "inning", "jugada", "cantidad", "pitcherResponsable", "timestamp"];
  let csv = headers.join(",") + "\n";

  // Exportar equipo visitante
  const visitante = partidoData.visitanteTeamName;
  const registrosVisitante = registrosJuego.filter(r => r.equipo === visitante);
  registrosVisitante.forEach(r => {
    csv += headers.map(h => `"${(r[h] || "").toString().replace(/"/g, '""')}"`).join(",") + "\n";
  });

  // Exportar equipo local
  const local = partidoData.localTeamName;
  const registrosLocal = registrosJuego.filter(r => r.equipo === local);
  registrosLocal.forEach(r => {
    csv += headers.map(h => `"${(r[h] || "").toString().replace(/"/g, '""')}"`).join(",") + "\n";
  });

  const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
  const link = document.createElement("a");
  link.href = URL.createObjectURL(blob);
  link.download = `partido_${partidoData.fecha}_${local}_vs_${visitante}.csv`;
  link.click();
}



function importarJuegoCSV(event) {
  const file = event.target.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = function(e) {
    const lines = e.target.result.split("\n");
    if (lines.length < 2) {
      alert("El archivo CSV no contiene datos válidos");
      return;
    }

    const headers = lines[0].trim().split(",");
    const registrosTemporales = [];

    for (let i = 1; i < lines.length; i++) {
      if (!lines[i].trim()) continue;
      const values = lines[i].split(",").map(v => v.trim().replace(/^"(.*)"$/, '$1').replace(/""/g, '"'));
      const registro = {};
      headers.forEach((h, idx) => {
        registro[h] = (h === 'cantidad' || h === 'inning' || h === 'numeroJuego')
          ? parseInt(values[idx]) || 0
          : values[idx];
      });
      registrosTemporales.push(registro);
    }

    const equiposUnicos = [...new Set(registrosTemporales.map(r => r.equipo))];
    const visitante = equiposUnicos[0] || "Visitante";
    const local = equiposUnicos[1] || "Local";

    const registrosVisitante = registrosTemporales.filter(r => r.equipo === visitante);
    const registrosLocal = registrosTemporales.filter(r => r.equipo === local);
    const registrosOrdenados = [...registrosVisitante, ...registrosLocal];

    registrosJuego = registrosOrdenados;

    partidoData.visitanteTeamName = visitante;
    partidoData.localTeamName = local;

    document.getElementById("visitante-team-name").value = visitante;
    document.getElementById("local-team-name").value = local;
    document.getElementById("lineup-visitante-name").value = visitante;
    document.getElementById("lineup-local-name").value = local;

    document.querySelector("#lineup-local tbody").innerHTML = "";
    document.querySelector("#lineup-visitante tbody").innerHTML = "";

    const agregarAlLineup = (tablaId, registros) => {
      const jugadores = {};
      registros.forEach(r => {
        const key = `${r.jugador}-${r.posicion}`;
        if (!jugadores[key]) jugadores[key] = [];
        jugadores[key].push(r);
      });

      Object.entries(jugadores).forEach(([key, jugadas], index) => {
        agregarJugador(tablaId);
        const row = document.querySelector(`#${tablaId} tbody`).rows[index];
        const jugadorSelect = row.querySelector(".jugador-select");
        const posicionSelect = row.querySelector(".posicion-select");
        if (jugadorSelect) jugadorSelect.value = jugadas[0].jugador;
        if (posicionSelect) posicionSelect.value = jugadas[0].posicion;

        jugadas.forEach(jugada => {
          const inningIndex = jugada.inning - 1;
          const cell = row.cells[4 + inningIndex];
          const select = cell.querySelector(".ining-select");
          const input = cell.querySelector(".ining-input");
          const label = cell.querySelector(".ining-label");
          const pitcherInput = cell.querySelector(".pitcher-name-input");

          select.value = jugada.jugada;
          input.value = jugada.cantidad;
          pitcherInput.value = jugada.pitcherResponsable || "";
          label.textContent += (label.textContent ? "+" : "") + `${jugada.cantidad}${jugada.jugada}`;
        });
      });
    };

    agregarAlLineup("lineup-visitante", registrosVisitante);
    agregarAlLineup("lineup-local", registrosLocal);

    actualizarRegistrosUI();
    actualizarResumenGlobal();
    guardarEstadoPartido();
  };

  reader.readAsText(file);
}




    function reconstruirDesdeRegistros() {
      if (registrosJuego.length === 0) { reiniciarPartido(); return; }
      
      const primerRegistro = registrosJuego[0];
      partidoData.fecha = primerRegistro.fecha || partidoData.fecha;
      partidoData.formato = primerRegistro.formato || partidoData.formato;
      partidoData.numeroJuego = primerRegistro.numeroJuego || partidoData.numeroJuego;

      document.getElementById("fecha").value = partidoData.fecha;
      document.getElementById("formato").value = partidoData.formato;
      document.getElementById("numeroJuego").value = partidoData.numeroJuego;

      // Agrupar datos por equipo y jugador
      const equiposDataMap = new Map();
      registrosJuego.forEach(r => {
        if (!equiposDataMap.has(r.equipo)) {
          equiposDataMap.set(r.equipo, {});
        }
        const jugadorData = equiposDataMap.get(r.equipo)[r.jugador] || { 
          posicion: r.posicion || "", 
          innings: {} 
        };
        
        jugadorData.innings[r.inning] = jugadorData.innings[r.inning] || [];
        jugadorData.innings[r.inning].push({ 
          jugada: r.jugada, 
          cantidad: r.cantidad, 
          pitcherResponsable: r.pitcherResponsable 
        });
        
        equiposDataMap.get(r.equipo)[r.jugador] = jugadorData;
      });

      // Asignar nombres de equipo si no están definidos
      const equiposEncontrados = Array.from(equiposDataMap.keys());
      if (!partidoData.visitanteTeamName && equiposEncontrados.length > 0) {
        partidoData.visitanteTeamName = equiposEncontrados[0];
      }
      if (!partidoData.localTeamName && equiposEncontrados.length > 1) {
        partidoData.localTeamName = equiposEncontrados[1];
      } else if (!partidoData.localTeamName) {
        partidoData.localTeamName = "Local";
      }

      // Actualizar inputs de nombres de equipo
      document.getElementById("visitante-team-name").value = partidoData.visitanteTeamName;
      document.getElementById("lineup-visitante-name").value = partidoData.visitanteTeamName;
      document.getElementById("local-team-name").value = partidoData.localTeamName;
      document.getElementById("lineup-local-name").value = partidoData.localTeamName;
      
      // Reconstruir tablas
      reconstruirTablaResumen();

      // Reconstruir lineups para cada equipo
      equiposDataMap.forEach((jugadores, equipoNombre) => {
        const esLocal = equipoNombre === partidoData.localTeamName;
        const tablaId = esLocal ? "lineup-local" : "lineup-visitante";
        
        // Convertir el mapa de jugadores a array para reconstruir
        const jugadoresArray = Object.entries(jugadores).map(([nombre, data]) => ({
          jugador: nombre,
          posicion: data.posicion,
          innings: data.innings
        }));
        
        reconstruirLineupDesdeGuardado(tablaId, jugadoresArray);
      });

      // Inicializar selectores y actualizar UI
      initializePositionSelectListeners("lineup-local");   
      initializePositionSelectListeners("lineup-visitante"); 
      initializePlayerNameSelectListeners();
      actualizarResumenGlobal();
      showInning(partidoData.currentInning || 1);
    }

    function reconstruirTablaResumen() {
      const resumenTabla = document.querySelector("#resumen-container table");
      const resumenThead = resumenTabla.querySelector("thead tr");
      const resumenTbodyVisitanteRow = resumenTabla.querySelector("tbody tr:first-child");
      const resumenTbodyLocalRow = resumenTabla.querySelector("tbody tr:last-child");

      if (resumenThead) {
        for (let i = resumenThead.children.length - 2; i >= 1; i--) {
          resumenThead.removeChild(resumenThead.children[i]);
        }
      }
      if (resumenTbodyVisitanteRow) {
        for (let i = resumenTbodyVisitanteRow.children.length - 2; i >= 1; i--) {
          resumenTbodyVisitanteRow.removeChild(resumenTbodyVisitanteRow.children[i]);
        }
      }
      if (resumenTbodyLocalRow) {
        for (let i = resumenTbodyLocalRow.children.length - 2; i >= 1; i--) {
          resumenTbodyLocalRow.removeChild(resumenTbodyLocalRow.children[i]);
        }
      }

      for (let i = 1; i <= maxInnings; i++) {
        if (resumenThead && resumenThead.lastElementChild) {
          const th = document.createElement("th");
          th.textContent = i;
          resumenThead.insertBefore(th, resumenThead.lastElementChild);
        }
        if (resumenTbodyVisitanteRow && resumenTbodyVisitanteRow.lastElementChild) {
          const td = document.createElement("td");
          td.innerHTML = `<div class="resumen-label" id="visitante-${i}">0</div>`;
          resumenTbodyVisitanteRow.insertBefore(td, resumenTbodyVisitanteRow.lastElementChild);
        }
        if (resumenTbodyLocalRow && resumenTbodyLocalRow.lastElementChild) {
          const td = document.createElement("td");
          td.innerHTML = `<div class="resumen-label" id="local-${i}">0</div>`;
          resumenTbodyLocalRow.insertBefore(td, resumenTbodyLocalRow.lastElementChild);
        }
      }
      document.getElementById("visitante-team-name").value = partidoData.visitanteTeamName || "Visitante";
      document.getElementById("local-team-name").value = partidoData.localTeamName || "Local";
    }

    function reconstruirLineupInnings(tablaId) {
        const tabla = document.getElementById(tablaId);
        if(!tabla) return;
        const theadRow = tabla.querySelector("thead tr");
        const tbodyRows = tabla.querySelectorAll("tbody tr");
        const firstInningHeaderIndex = 4; 
        if(theadRow) {
            while (theadRow.children.length > firstInningHeaderIndex) { 
                theadRow.removeChild(theadRow.children[firstInningHeaderIndex]); 
            }
            for (let i = 1; i <= maxInnings; i++) {
                const newTh = document.createElement("th");
                newTh.textContent = i;
                newTh.classList.add('inning-column', `inning-${i}`);
                theadRow.appendChild(newTh);
            }
        }
        const jugadasOptions = obtenerJugadas().map(j => `<option value="${j.nombre}">${j.nombre}</option>`).join("");
        tbodyRows.forEach(row => {
            while (row.children.length > firstInningHeaderIndex) { 
                row.removeChild(row.children[firstInningHeaderIndex]);
            }
            for (let i = 1; i <= maxInnings; i++) {
                const nuevaCelda = document.createElement("td");
                nuevaCelda.classList.add('inning-column', `inning-${i}`);
                nuevaCelda.innerHTML = `
                    <div class="ining-container">
                        <select class="ining-select"><option value="">--</option>${jugadasOptions}</select>
                        <input type="number" class="ining-input" value="1" min="-999" max="999">
                        <button class="ining-guardar" onclick="guardarJugada(this, '${tablaId}', ${i})"><i class="fas fa-save"></i> Guardar</button>
                        <div class="ining-label"></div>
                        <input type="hidden" class="pitcher-name-input" value=""></div>`;
                row.appendChild(nuevaCelda);
            }
        });
        actualizarResumenGlobal();
        showInning(currentInning); 
        updatePositionAvailability(tablaId); 
    }

    function agregarInning() {
      maxInnings++;
      partidoData.maxInnings = maxInnings; // Sincronizar con partidoData
      const resumenThead = document.querySelector("#resumen-container table thead tr");
      const newTh = document.createElement("th");
      newTh.textContent = maxInnings;
      if (resumenThead && resumenThead.lastElementChild) resumenThead.insertBefore(newTh, resumenThead.lastElementChild);
      else if (resumenThead) resumenThead.appendChild(newTh);

      const resumenTbodyVisitanteRow = document.querySelector("#resumen-container table tbody tr:first-child");
      const resumenTbodyLocalRow = document.querySelector("#resumen-container table tbody tr:last-child");
      
      if (resumenTbodyVisitanteRow && resumenTbodyVisitanteRow.lastElementChild) {
        const td = document.createElement("td");
        td.innerHTML = `<div class="resumen-label" id="visitante-${maxInnings}">0</div>`;
        resumenTbodyVisitanteRow.insertBefore(td, resumenTbodyVisitanteRow.lastElementChild);
      }
      if (resumenTbodyLocalRow && resumenTbodyLocalRow.lastElementChild) {
        const td = document.createElement("td");
        td.innerHTML = `<div class="resumen-label" id="local-${maxInnings}">0</div>`;
        resumenTbodyLocalRow.insertBefore(td, resumenTbodyLocalRow.lastElementChild);
      }
      
      const lineups = ["lineup-local", "lineup-visitante"];
      const jugadasOptions = obtenerJugadas().map(j => `<option value="${j.nombre}">${j.nombre}</option>`).join("");
      lineups.forEach(lineupId => {
        const tabla = document.getElementById(lineupId);
        if (!tabla) return;
        const theadRow = tabla.querySelector("thead tr");
        const tbodyRows = tabla.querySelectorAll("tbody tr");
        if(theadRow) {
            const newInningTh = document.createElement("th");
            newInningTh.textContent = maxInnings;
            newInningTh.classList.add('inning-column', `inning-${maxInnings}`); 
            theadRow.appendChild(newInningTh);
        }
        tbodyRows.forEach(row => {
          const nuevaCelda = document.createElement("td");
          nuevaCelda.classList.add('inning-column', `inning-${maxInnings}`); 
          nuevaCelda.innerHTML = `
            <div class="ining-container">
              <select class="ining-select"><option value="">--</option>${jugadasOptions}</select>
              <input type="number" class="ining-input" value="1" min="-999" max="999">
              <button class="ining-guardar" onclick="guardarJugada(this, '${lineupId}', ${maxInnings})"><i class="fas fa-save"></i> Guardar</button>
              <div class="ining-label"></div>
              <input type="hidden" class="pitcher-name-input" value=""></div>`;
          row.appendChild(nuevaCelda);
        });
      });
      showInning(currentInning); 
      guardarEstadoPartido();
    }

    function reiniciarPartido() {
        if (confirm("¿Estás seguro de que quieres reiniciar el partido? Se perderán todos los registros de jugadas, pero los jugadores en el lineup se mantendrán.")) {
            // 1. Resetear partidoData a valores por defecto coherentes
            partidoData.localTeamName = "Local";
            partidoData.visitanteTeamName = "Visitante";
            partidoData.registros = [];
            partidoData.maxInnings = 9;
            partidoData.currentInning = 1;
            partidoData.isTopInning = true;
            partidoData.outs = 0;
            partidoData.bases = [false, false, false];
            partidoData.showDetails = false;
            // Limpiar también los lineups en partidoData si se guardan allí
            partidoData.localLineup = []; 
            partidoData.visitanteLineup = [];

            // 2. Actualizar campos de información general del DOM
            document.getElementById("fecha").value = new Date().toISOString().split('T')[0];
            document.getElementById("formato").value = partidoData.formato || ""; // Mantener si existe o limpiar
            document.getElementById("numeroJuego").value = partidoData.numeroJuego || ""; // Mantener si existe o limpiar
            
            document.getElementById("local-team-name").value = partidoData.localTeamName;
            document.getElementById("visitante-team-name").value = partidoData.visitanteTeamName;
            document.getElementById("lineup-local-name").value = partidoData.localTeamName;
            document.getElementById("lineup-visitante-name").value = partidoData.visitanteTeamName;
            
            // 3. Limpiar datos visuales de los lineups (pero no los jugadores si se quiere mantenerlos)
            // Si se quiere borrar jugadores también, se haría tbody.innerHTML = "";
            ["lineup-local", "lineup-visitante"].forEach(tablaId => {
                const tbody = document.getElementById(tablaId).querySelector("tbody");
                if (tbody) { // Solo limpiar si el tbody existe
                    tbody.querySelectorAll("tr").forEach(row => {
                        row.querySelectorAll(".ining-label").forEach(label => label.textContent = "");
                        row.querySelectorAll(".pitcher-name-input").forEach(input => input.value = "");
                        // Opcional: resetear selects de jugada e inputs de cantidad si se mantienen jugadores
                        row.querySelectorAll(".ining-select").forEach(sel => sel.value = "");
                        row.querySelectorAll(".ining-input").forEach(inp => inp.value = "1");
                    });
                }
            });

            // 4. Sincronizar variables globales con el estado reseteado de partidoData
            maxInnings = partidoData.maxInnings; 
            currentInning = partidoData.currentInning;
            isTopInning = partidoData.isTopInning;
            outs = partidoData.outs; 
            bases = [...partidoData.bases]; 
            registrosJuego = [...partidoData.registros]; 
            
            // 5. Reconstruir la estructura de la tabla resumen y columnas de inning en lineups
            reconstruirTablaResumen(); // Utilizará los nombres reseteados en partidoData
            reconstruirLineupInnings("lineup-local"); 
            reconstruirLineupInnings("lineup-visitante");

            // 6. Actualizar todas las UIs
            document.getElementById("registros-container").innerHTML = "";
            actualizarResumenGlobal(); 
            initializePositionSelectListeners("lineup-local");   
            initializePositionSelectListeners("lineup-visitante"); 
            initializePlayerNameSelectListeners();
            showInning(currentInning);
            if (document.getElementById('game-details-container')) { // Asegurarse que existe
                document.getElementById('game-details-container').classList.add('hidden');
            }
            if (document.querySelector('.toggle-details-btn')) { // Asegurarse que existe
                 document.querySelector('.toggle-details-btn').innerHTML = '<i class="fas fa-cog"></i> Mostrar Detalles Adicionales';
            }
            
            // 7. Guardar el estado completamente reseteado
            guardarEstadoPartido();
            alert("Partido reiniciado. Las jugadas y puntajes han sido borrados.");
        }
    }



function terminarPartido() {
      if (registrosJuego.length > 0) {
          exportarJuegoCSV();
          guardarJuego(); // <- LLAMADA A guardarJuego() AÑADIDA AQUÍ
      }
       if (confirm("¿Estás seguro de que quieres terminar el partido? Se exportarán los datos y se limpiará todo para un nuevo partido.")) {
        partidoData = { 
            fecha: new Date().toISOString().split('T')[0], formato: "", numeroJuego: "",
            localTeamName: "Local", visitanteTeamName: "Visitante",
            localLineup: [], visitanteLineup: [],
            registros: [], maxInnings: 9, currentInning: 1, isTopInning: true,
            outs: 0, bases: [false, false, false], showDetails: false
        };
        
        document.getElementById("fecha").value = partidoData.fecha;
        document.getElementById("formato").value = partidoData.formato;
        document.getElementById("numeroJuego").value = partidoData.numeroJuego;
        document.getElementById("local-team-name").value = partidoData.localTeamName;
        document.getElementById("visitante-team-name").value = partidoData.visitanteTeamName;
        document.getElementById("lineup-local-name").value = partidoData.localTeamName;
        document.getElementById("lineup-visitante-name").value = partidoData.visitanteTeamName;
        
        document.getElementById("lineup-local").querySelector("tbody").innerHTML = "";
        document.getElementById("lineup-visitante").querySelector("tbody").innerHTML = "";

        maxInnings = partidoData.maxInnings; 
        currentInning = partidoData.currentInning;
        isTopInning = partidoData.isTopInning;
        outs = partidoData.outs; 
        bases = [...partidoData.bases]; 
        registrosJuego = [...partidoData.registros];
        
        reconstruirTablaResumen();
        reconstruirLineupInnings("lineup-local"); 
        reconstruirLineupInnings("lineup-visitante"); 

        document.getElementById("registros-container").innerHTML = "";
        actualizarResumenGlobal(); 
        initializePositionSelectListeners("lineup-local");   
        initializePositionSelectListeners("lineup-visitante"); 
        initializePlayerNameSelectListeners(); 
        guardarEstadoPartido(); 
        alert("Partido terminado y datos exportados y guardados (si había). Campos limpiados para un nuevo partido.");
      }
    }


    function guardarEstadoPartido() {
      const localLineupRows = Array.from(document.getElementById("lineup-local").querySelectorAll("tbody tr"));
      const visitanteLineupRows = Array.from(document.getElementById("lineup-visitante").querySelectorAll("tbody tr"));
      const parseLineupRow = (row) => { 
          const jugadorSelect = row.querySelector(".jugador-select");
          const posicionSelect = row.querySelector(".posicion-select");
          const jugador = jugadorSelect ? jugadorSelect.value : "";
          const posicion = posicionSelect ? posicionSelect.value : "";
          const inningsData = {};
          for (let inningNum = 1; inningNum <= maxInnings; inningNum++) {
              const cell = row.cells[3 + inningNum];
              if (cell) { 
                  const label = cell.querySelector(".ining-label");
                  const pitcherInput = cell.querySelector(".pitcher-name-input"); 
                  if (label && (label.textContent || (pitcherInput && pitcherInput.value))) { 
                      inningsData[inningNum] = {
                        jugadas: label.textContent || "",
                        pitcher: pitcherInput ? pitcherInput.value : "" 
                      };
                  }
              }
          }
          return { jugador, posicion, innings: inningsData };
      };
      
      // Asegurar que partidoData.localTeamName y visitanteTeamName están actualizados ANTES de guardar
      partidoData.localTeamName = document.getElementById("local-team-name").value || "Local";
      partidoData.visitanteTeamName = document.getElementById("visitante-team-name").value || "Visitante";
      partidoData.fecha = document.getElementById("fecha").value;
      partidoData.formato = document.getElementById("formato").value;
      partidoData.numeroJuego = document.getElementById("numeroJuego").value;
      partidoData.registros = registrosJuego; // Usar la variable global que se actualiza
      partidoData.maxInnings = maxInnings;
      partidoData.currentInning = currentInning;
      partidoData.isTopInning = isTopInning;
      partidoData.outs = outs;
      partidoData.bases = bases;
      partidoData.showDetails = document.getElementById('game-details-container') ? !document.getElementById('game-details-container').classList.contains('hidden') : false;
      partidoData.localLineup = localLineupRows.map(parseLineupRow);
      partidoData.visitanteLineup = visitanteLineupRows.map(parseLineupRow);
      
      localStorage.setItem("partidoEnCurso", JSON.stringify(partidoData));
    }

    function cargarEstadoPartido() {
      const savedData = localStorage.getItem("partidoEnCurso");
      if (savedData) {
        partidoData = JSON.parse(savedData);
        
        // Sincronizar variables globales con partidoData cargado
        registrosJuego = partidoData.registros || [];
        maxInnings = partidoData.maxInnings || 9;
        currentInning = partidoData.currentInning || 1; 
        isTopInning = (typeof partidoData.isTopInning === 'boolean') ? partidoData.isTopInning : true;
        outs = (typeof partidoData.outs === 'number') ? partidoData.outs : 0; 
        bases = partidoData.bases || [false, false, false];
        
        document.getElementById("fecha").value = partidoData.fecha || new Date().toISOString().split('T')[0];
        document.getElementById("formato").value = partidoData.formato || "";
        document.getElementById("numeroJuego").value = partidoData.numeroJuego || "";
        
        // Establecer nombres de equipo en inputs ANTES de reconstruir la tabla resumen
        document.getElementById("visitante-team-name").value = partidoData.visitanteTeamName || "Visitante";
        document.getElementById("lineup-visitante-name").value = partidoData.visitanteTeamName || "Visitante";
        document.getElementById("local-team-name").value = partidoData.localTeamName || "Local";
        document.getElementById("lineup-local-name").value = partidoData.localTeamName || "Local";
        
        reconstruirTablaResumen(); // Ahora usará los nombres correctos de partidoData que ya están en los inputs
        
        if (partidoData.visitanteLineup && partidoData.visitanteLineup.length > 0) {
            reconstruirLineupDesdeGuardado("lineup-visitante", partidoData.visitanteLineup);
        } else {
            document.getElementById("lineup-visitante").querySelector("tbody").innerHTML = ""; 
            reconstruirLineupInnings("lineup-visitante"); 
        }
        if (partidoData.localLineup && partidoData.localLineup.length > 0) {
            reconstruirLineupDesdeGuardado("lineup-local", partidoData.localLineup);
        } else {
            document.getElementById("lineup-local").querySelector("tbody").innerHTML = ""; 
            reconstruirLineupInnings("lineup-local"); 
        }
        
        actualizarRegistrosUI();
        actualizarResumenGlobal(); // Debe llamarse después de que todo esté reconstruido
        
        const gameDetailsContainer = document.getElementById('game-details-container');
        const toggleButton = document.querySelector('.toggle-details-btn');
        if(gameDetailsContainer && toggleButton){
            if (partidoData.showDetails) {
                gameDetailsContainer.classList.remove('hidden');
                toggleButton.innerHTML = '<i class="fas fa-cog"></i> Esconder Detalles Adicionales';
            } else {
                gameDetailsContainer.classList.add('hidden');
                toggleButton.innerHTML = '<i class="fas fa-cog"></i> Mostrar Detalles Adicionales';
            }
        }
        showInning(currentInning); 
      } else { 
        // Estado inicial si no hay datos guardados
        partidoData.localTeamName = "Local"; // Asegurar valores por defecto en partidoData
        partidoData.visitanteTeamName = "Visitante";
        document.getElementById("visitante-team-name").value = partidoData.visitanteTeamName;
        document.getElementById("local-team-name").value = partidoData.localTeamName;
        document.getElementById("lineup-visitante-name").value = partidoData.visitanteTeamName;
        document.getElementById("lineup-local-name").value = partidoData.localTeamName;

        reconstruirTablaResumen();
        reconstruirLineupInnings("lineup-local");
        reconstruirLineupInnings("lineup-visitante");
        showInning(currentInning);
      }
    }

    function reconstruirLineupDesdeGuardado(tablaId, savedPlayersArray) {
        const tbody = document.getElementById(tablaId).querySelector("tbody");
        if (!tbody) return;
        tbody.innerHTML = ""; 
        const jugadoresEnLocalStorage = obtenerJugadores();
        const jugadasOptions = obtenerJugadas().map(j => `<option value="${j.nombre}">${j.nombre}</option>`).join("");
        
        const theadRow = document.getElementById(tablaId).querySelector("thead tr");
        if(theadRow){
            const firstInningHeaderIndex = 4; 
            while (theadRow.children.length > firstInningHeaderIndex) { 
                theadRow.removeChild(theadRow.children[firstInningHeaderIndex]);
            }
            for (let i = 1; i <= maxInnings; i++) {
                const newTh = document.createElement("th");
                newTh.textContent = i;
                newTh.classList.add('inning-column', `inning-${i}`); 
                theadRow.appendChild(newTh);
            }
        }

        savedPlayersArray.forEach((playerData, index) => {
            const tr = document.createElement("tr");
            const playerIndex = index + 1; 
            let celdasIning = "";
            for (let inning = 1; inning <= maxInnings; inning++) { 
                const inningDetails = (playerData.innings && playerData.innings[inning]) ? playerData.innings[inning] : { jugadas: "", pitcher: "" };
                const labelText = inningDetails.jugadas;
                const pitcherName = inningDetails.pitcher;
                const isActiveInning = (inning === currentInning); 
                celdasIning += `
                    <td class="inning-column inning-${inning} ${isActiveInning ? 'active' : ''}">
                        <div class="ining-container">
                            <select class="ining-select"><option value="">--</option>${jugadasOptions}</select>
                            <input type="number" class="ining-input" value="1" min="-999" max="999">
                            <button class="ining-guardar" onclick="guardarJugada(this, '${tablaId}', ${inning})"><i class="fas fa-save"></i> Guardar</button>
                            <div class="ining-label">${labelText}</div>
                            <input type="hidden" class="pitcher-name-input" value="${pitcherName || ''}"></div></td>`;
            }
            const opcionesJugadores = jugadoresEnLocalStorage.map(j => 
                `<option value="${j.nombre}" ${j.nombre === playerData.jugador ? 'selected' : ''}>${j.nombre}</option>`
            ).join("");
            const opcionesPosiciones = posiciones.map(p => 
                `<option value="${p}" ${p === playerData.posicion ? 'selected' : ''}>${p}</option>`
            ).join("");
            tr.innerHTML = `
                <td class="sticky-column-1">${playerIndex}</td>
                <td class="sticky-column-2"><select class="jugador-select"><option value="">Seleccionar</option>${opcionesJugadores}</select></td>
                <td class="sticky-column-3"><select class="posicion-select"><option value="">--</option>${opcionesPosiciones}</select></td>
                <td class="sticky-column-delete"><button class="delete-player-btn" onclick="eliminarJugador(this, '${tablaId}')">X</button></td>
                ${celdasIning}`;
            tbody.appendChild(tr);
        });
        initializePositionSelectListeners(tablaId); 
    }

    function showInning(inningNum) {
      currentInning = inningNum;
      partidoData.currentInning = currentInning; // Sincronizar con partidoData
      const displayEl = document.getElementById('current-inning-display');
      if (displayEl) displayEl.textContent = `Inning ${inningNum}`;
      
      document.querySelectorAll('#lineup-local .inning-column, #lineup-visitante .inning-column').forEach(col => {
        const match = col.className.match(/inning-(\d+)/);
        if (match) col.classList.toggle('active', parseInt(match[1]) === inningNum);
      });
      actualizarEstadisticasAdicionales(); 
      // guardarEstadoPartido(); // Se llama desde donde se invoca showInning si es necesario
    }

    function showPrevInning() {
      if (currentInning > 1) {
        showInning(currentInning - 1);
        guardarEstadoPartido(); // Guardar estado después de cambiar inning
      }
    }

    function showNextInning() {
      if (currentInning < maxInnings) {
        showInning(currentInning + 1);
        guardarEstadoPartido(); // Guardar estado después de cambiar inning
      }
    }

    function toggleGameDetails() {
        const detailsContainer = document.getElementById('game-details-container');
        const toggleButton = document.querySelector('.toggle-details-btn');
        if(detailsContainer && toggleButton){
            detailsContainer.classList.toggle('hidden');
            partidoData.showDetails = !detailsContainer.classList.contains('hidden');
            toggleButton.innerHTML = partidoData.showDetails ? 
                '<i class="fas fa-cog"></i> Esconder Detalles Adicionales' : 
                '<i class="fas fa-cog"></i> Mostrar Detalles Adicionales';
            guardarEstadoPartido();
        }
    }

    function toggleTopDown() {
        isTopInning = !isTopInning;
        outs = 0; 
        clearBases();
        partidoData.isTopInning = isTopInning; // Sincronizar
        partidoData.outs = outs;
        actualizarEstadisticasAdicionales(); 
        guardarEstadoPartido();
    }

    function addOut(quantity = 1) {
        outs += quantity;
        if (outs >= 3) {
            outs = 0; 
            clearBases(); 
            if (isTopInning) {
                isTopInning = false; 
            } else {
                isTopInning = true; 
                currentInning++; 
                if (currentInning > maxInnings && registrosJuego.length > 0) {
                    // No agregar inning automáticamente, solo mostrar el último válido o el nuevo si se agregó manualmente.
                }
                showInning(currentInning <= maxInnings ? currentInning : maxInnings); 
            }
            partidoData.isTopInning = isTopInning; // Sincronizar
            partidoData.currentInning = currentInning;
        }
        partidoData.outs = outs; // Sincronizar
        actualizarEstadisticasAdicionales(); 
        guardarEstadoPartido();
    }

    function resetOuts() {
        outs = 0;
        partidoData.outs = outs; // Sincronizar
        actualizarEstadisticasAdicionales(); 
        guardarEstadoPartido();
    }

    function updateBasesDisplay() {
        ['base1', 'base2', 'base3'].forEach((baseId, index) => {
            const el = document.getElementById(baseId);
            if(el) el.classList.toggle('occupied', bases[index]);
        });
    }

    function toggleBase(baseNumber) {
        bases[baseNumber - 1] = !bases[baseNumber - 1]; 
        partidoData.bases = [...bases]; // Sincronizar
        updateBasesDisplay();
        guardarEstadoPartido();
    }


// FUNCION GUARDAR JUEGO
function guardarJuego() {
  const juegosGuardados = JSON.parse(localStorage.getItem("historialJuegos")) || [];

  const juegoCompleto = {
    fecha: document.getElementById("fecha").value || new Date().toLocaleDateString(),
    formato: document.getElementById("formato").value || "Sin Formato",
    numeroJuego: document.getElementById("numeroJuego").value || "N/A",
    equipoLocal: partidoData.localTeamName || "Local",
    equipoVisitante: partidoData.visitanteTeamName || "Visitante",
    lineupLocal: obtenerLineupCompleto("lineup-local"),
    lineupVisitante: obtenerLineupCompleto("lineup-visitante"),
    registros: registrosJuego,
    maxInnings: partidoData.maxInnings,
    currentInning: partidoData.currentInning,
    isTopInning: partidoData.isTopInning,
    outs: partidoData.outs,
    bases: partidoData.bases,
    timestamp: new Date().toISOString()
  };

  juegosGuardados.push(juegoCompleto);
  localStorage.setItem("historialJuegos", JSON.stringify(juegosGuardados));
  alert("¡Juego guardado exitosamente en el historial!");
}

function obtenerLineupCompleto(tablaId) {
  const tabla = document.getElementById(tablaId);
  const lineup = [];

  if (!tabla) return lineup;

  const filas = tabla.querySelectorAll("tbody tr");
  filas.forEach((fila, index) => {
    const jugador = fila.querySelector(".jugador-select")?.value || "";
    const posicion = fila.querySelector(".posicion-select")?.value || "";
    const iningData = [];

    for (let i = 4; i < fila.cells.length; i++) {
      const cell = fila.cells[i];
      const jugada = cell.querySelector(".ining-select")?.value || "";
      const cantidad = cell.querySelector(".ining-input")?.value || "";
      const label = cell.querySelector(".ining-label")?.textContent || "";
      iningData.push({
        inning: i - 3,
        jugada: jugada,
        cantidad: cantidad,
        resumen: label
      });
    }

    lineup.push({
      numero: index + 1,
      jugador: jugador,
      posicion: posicion,
      inings: iningData
    });
  });

  return lineup;
}



// FUNCION MOSTRAR HISTORIAL DE JUEGOS
function mostrarHistorialJuegos() {
  window.location.href = "historial.html"; // Asegúrate de crear este archivo en tu proyecto
}


// FUNCION FINAL Y CORREGIDA: CARGAR JUEGO SELECCIONADO DESDE HISTORIAL
function cargarJuegoSeleccionado() {
  // Leer el juego almacenado en localStorage
  const juegoSeleccionado = JSON.parse(localStorage.getItem("juegoSeleccionado"));
  if (!juegoSeleccionado) return; // Si no hay juego cargado, salir

  // Cargar datos principales del partido
  document.getElementById("fecha").value = juegoSeleccionado.fecha || "";
  document.getElementById("formato").value = juegoSeleccionado.formato || "";
  document.getElementById("numeroJuego").value = juegoSeleccionado.numeroJuego || "";

  // Actualizar nombres de equipos
  document.getElementById("lineup-local-name").value = juegoSeleccionado.equipoLocal;
  document.getElementById("lineup-visitante-name").value = juegoSeleccionado.equipoVisitante;
  document.getElementById("local-team-name").value = juegoSeleccionado.equipoLocal;
  document.getElementById("visitante-team-name").value = juegoSeleccionado.equipoVisitante;

  partidoData.localTeamName = juegoSeleccionado.equipoLocal;
  partidoData.visitanteTeamName = juegoSeleccionado.equipoVisitante;
  partidoData.maxInnings = juegoSeleccionado.maxInnings || 9;
  partidoData.currentInning = juegoSeleccionado.currentInning || 1;
  partidoData.isTopInning = juegoSeleccionado.isTopInning || true;
  partidoData.outs = juegoSeleccionado.outs || 0;
  partidoData.bases = juegoSeleccionado.bases || [false, false, false];

  // Cargar lineups con su estructura
  cargarLineup("lineup-local", juegoSeleccionado.lineupLocal);
  cargarLineup("lineup-visitante", juegoSeleccionado.lineupVisitante);

  // Cargar jugadas detalladas de cada jugador e inning
  if (juegoSeleccionado.registros) {
    reconstruirJugadas(juegoSeleccionado.registros);
  }

  // Refrescar la interfaz del partido
  actualizarResumenGlobal();
  actualizarRegistrosUI();

  // Una vez cargado, eliminamos la clave temporal para evitar duplicados
  localStorage.removeItem("juegoSeleccionado");
}

function reconstruirJugadas(registros) {
  registros.forEach(reg => {
    const tablaId = reg.equipo === partidoData.localTeamName ? "lineup-local" : "lineup-visitante";
    const tabla = document.getElementById(tablaId);
    if (!tabla) return;

    const filas = tabla.querySelectorAll("tbody tr");
    filas.forEach(fila => {
      const nombreJugador = fila.querySelector(".jugador-select")?.value;
      if (nombreJugador === reg.jugador) {
        const cell = fila.querySelector(`.inning-${reg.inning}`);
        if (cell) {
          const select = cell.querySelector(".ining-select");
          const input = cell.querySelector(".ining-input");
          const label = cell.querySelector(".ining-label");

          if (select) select.value = reg.jugada || "";
          if (input) input.value = reg.cantidad || "";
          if (label) label.textContent = reg.resumen || "";
        }
      }
    });
  });
}

function cargarLineup(tablaId, lineupData) {
  const tabla = document.getElementById(tablaId);
  const tbody = tabla.querySelector("tbody");
  tbody.innerHTML = "";

  lineupData.forEach(jugador => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td class="sticky-column-1">${jugador.numero}</td>
      <td class="sticky-column-2">
        <select class="jugador-select"><option value="">Seleccionar</option></select>
      </td>
      <td class="sticky-column-3">
        <select class="posicion-select"><option value="">--</option></select>
      </td>
      <td class="sticky-column-delete"><button class="delete-player-btn" onclick="eliminarJugador(this, '${tablaId}')">X</button></td>
    `;

    for (let i = 0; i < jugador.inings.length; i++) {
      const ining = jugador.inings[i];
      const cell = document.createElement("td");
      cell.className = `inning-column inning-${ining.inning}`;
      cell.innerHTML = `
        <div class="ining-container">
          <select class="ining-select"><option value="">--</option></select>
          <input type="number" class="ining-input" value="${ining.cantidad}" min="-999" max="999">
          <button class="ining-guardar" onclick="guardarJugada(this, '${tablaId}', ${ining.inning})"><i class="fas fa-save"></i> Guardar</button>
          <div class="ining-label">${ining.resumen}</div>
          <input type="hidden" class="pitcher-name-input" value="">
        </div>
      `;
      tr.appendChild(cell);
    }

    tbody.appendChild(tr);
  });

  initializePlayerNameSelectListeners();
  initializePositionSelectListeners(tablaId);
}






    function clearBases() {
        bases = [false, false, false];
        partidoData.bases = [...bases]; // Sincronizar
        updateBasesDisplay();
        guardarEstadoPartido();
    }
	// Cargar título dinámico
    function cargarTituloDinamico() {
      const savedTitle = localStorage.getItem('mainAppTitle') || 'LIGA DE SOFTBALL ÑANGUETE';
      document.getElementById('dynamic-title').textContent = savedTitle;
      document.title = `Partidos - ${savedTitle}`;
    }
    window.onload = function() {
      inicializarDatosEjemplo();
      cargarFormatos();
      cargarTituloDinamico();
      document.getElementById("formato").addEventListener("change", cambiarFormato);
      cargarEstadoPartido(); // Esto reconstruye y actualiza todo
      
      initializePositionSelectListeners("lineup-local");   
      initializePositionSelectListeners("lineup-visitante"); 
      initializePlayerNameSelectListeners(); 

      const jugadas = obtenerJugadas();
      if (jugadas.length === 0) console.warn("No se encontraron jugadas registradas.");
      
      const homeButton = document.querySelector('a[href="index.html"]');
      if(homeButton) homeButton.addEventListener("click", function() { guardarEstadoPartido(); });
    };

    window.addEventListener("beforeunload", function() {
      guardarEstadoPartido(); 
    });



// LLAMAR ESTA FUNCION AL CARGAR LA PAGINA
// ➡️ Coloca esta línea al final de tu <script> en Partidos.html
document.addEventListener("DOMContentLoaded", cargarJuegoSeleccionado);

  </script>
</body>
</html>